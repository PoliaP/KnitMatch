<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ö–µ–º—ã –¥–ª—è –≤—è–∑–∞–Ω–∏—è - KnitMatch</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/projects.css' %}">
    <style>
        .pattern-card { opacity: 0; animation: fadeInUp 0.3s ease forwards; }
        .notification {
            position: fixed; top: 20px; right: 20px; 
            z-index: 1000; max-width: 400px;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ */
        .pagination .page-link {
            color: #8a4fff;
            border: 1px solid #dee2e6;
        }
        .pagination .page-item.active .page-link {
            background-color: #8a4fff;
            border-color: #8a4fff;
            color: white;
        }
        .pagination .page-link:hover {
            background-color: #f8f9fa;
            color: #00d4aa;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Å—ã–ª–æ–∫ –Ω–∞ Ravelry */
        .ravelry-link {
            background-color: #2b383f;
            color: white;
            border: none;
        }
        .ravelry-link:hover {
            background-color: #1a2226;
            color: white;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .pattern-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .pattern-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
        }
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="{% url 'home' %}">
                <div class="d-flex align-items-center">
                    <img src="{% static 'images/logo.jpg' %}" alt="Logo" height="60" class="rounded-circle me-2">
                    <div>
                        <span style="color: #8a4fff; font-weight: bold; font-size: 1.4rem;">Knit</span>
                        <span style="color: #00d4aa; font-weight: bold; font-size: 1.4rem;">Match</span>
                    </div>
                </div>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav ms-auto">
                    <a href="{% url 'home' %}" class="nav-link me-2">
                        <button class="btn nav-btn"><i class="fas fa-home me-1"></i>–ì–ª–∞–≤–Ω–∞—è</button>
                    </a>
                    <a href="{% url 'projects' %}" class="nav-link me-2">
                        <button class="btn nav-btn active"><i class="fas fa-project-diagram me-1"></i>–°—Ö–µ–º—ã</button>
                    </a>
                    <a href="{% url 'favorites' %}" class="nav-link me-2">
                        <button class="btn nav-btn"><i class="fas fa-heart me-1"></i>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
                    </a>
                    <a href="{% url 'my_yarn' %}" class="nav-link me-2">
                        <button class="btn nav-btn"><i class="fas fa-box me-1"></i>–ú–æ—è –ø—Ä—è–∂–∞</button>
                    </a>
                    <div class="nav-link">
                        <a href="{% url 'logout' %}" class="btn btn-outline-primary">
                            <i class="fas fa-sign-out-alt me-1"></i>–í—ã–π—Ç–∏
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="main-content py-4">
        <div class="container">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-container" id="stats">
                <div class="stat-card">
                    <div class="stat-icon stat-icon-1"><i class="fas fa-cube"></i></div>
                    <div class="stat-number">{{ total_patterns|default:"0" }}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å—Ö–µ–º</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-icon-2"><i class="fas fa-gift"></i></div>
                    <div class="stat-number">{{ page_obj.paginator.count }}</div>
                    <div class="stat-label">–ù–∞–π–¥–µ–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-icon-3"><i class="fas fa-star"></i></div>
                    <div class="stat-number">{{ favorite_pattern_ids|length }}</div>
                    <div class="stat-label">–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-icon-4"><i class="fas fa-download"></i></div>
                    <div class="stat-number">{% now "H:i" %}</div>
                    <div class="stat-label">–û–±–Ω–æ–≤–ª–µ–Ω–æ</div>
                </div>
            </div>

            <div class="row">
                <!-- –§–∏–ª—å—Ç—Ä—ã -->
                <div class="col-lg-3">
                    <div class="filter-card">
                        <div class="filter-header">
                            <h3 class="filter-title"><i class="fas fa-filter me-2"></i>–§–∏–ª—å—Ç—Ä—ã</h3>
                        </div>
                        
                        <!-- –°–ª–æ–∂–Ω–æ—Å—Ç—å -->
                        <div class="filter-group">
                            <label class="filter-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
                            <select class="filter-select" id="difficultyFilter">
                                <option value="">–í—Å–µ —É—Ä–æ–≤–Ω–∏</option>
                                <option value="beginner" {% if difficulty_filter == 'beginner' %}selected{% endif %}>–ù–∞—á–∏–Ω–∞—é—â–∏–π</option>
                                <option value="easy" {% if difficulty_filter == 'easy' %}selected{% endif %}>–õ–µ–≥–∫–∏–π</option>
                                <option value="intermediate" {% if difficulty_filter == 'intermediate' %}selected{% endif %}>–°—Ä–µ–¥–Ω–∏–π</option>
                                <option value="experienced" {% if difficulty_filter == 'experienced' %}selected{% endif %}>–û–ø—ã—Ç–Ω—ã–π</option>
                            </select>
                        </div>
                        
                        <!-- –¢–∏–ø –ø—Ä—è–∂–∏ -->
                        <div class="filter-group">
                            <label class="filter-label">–¢–∏–ø –ø—Ä—è–∂–∏</label>
                            <select class="filter-select" id="yarnWeightFilter">
                                <option value="">–õ—é–±–∞—è –ø—Ä—è–∂–∞</option>
                                {% for weight in yarn_weights %}
                                <option value="{{ weight }}" {% if yarn_weight_filter == weight %}selected{% endif %}>{{ weight }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <!-- –ß–µ–∫–±–æ–∫—Å—ã -->
                        <div class="filter-group">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="freeOnly">
                                <label class="form-check-label" for="freeOnly">–¢–æ–ª—å–∫–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="withPhotos">
                                <label class="form-check-label" for="withPhotos">–¢–æ–ª—å–∫–æ —Å —Ñ–æ—Ç–æ</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="highRated">
                                <label class="form-check-label" for="highRated">–í—ã—Å–æ–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥ (4+)</label>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary w-100 mt-3" onclick="applyFilters()">
                            <i class="fas fa-check me-2"></i>–ü—Ä–∏–º–µ–Ω–∏—Ç—å
                        </button>
                        <button class="btn btn-outline-primary w-100 mt-2" onclick="resetFilters()">
                            <i class="fas fa-redo me-2"></i>–°–±—Ä–æ—Å–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <!-- –°—Ö–µ–º—ã -->
                <div class="col-lg-9">
                    <!-- –ü–æ–∏—Å–∫ -->
                    <div class="search-box mb-4">
                        <div class="row align-items-center">
                            <div class="col-md-8 mb-3 mb-md-0">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                                    <input type="text" class="form-control" id="searchInput" 
                                           placeholder="–ü–æ–∏—Å–∫ —Å—Ö–µ–º..." 
                                           value="{{ search_query|default:'' }}">
                                </div>
                            </div>
                            <div class="col-md-2 mb-3 mb-md-0">
                                <button class="btn btn-primary w-100" onclick="applyFilters()">
                                    <i class="fas fa-search me-2"></i>–ù–∞–π—Ç–∏
                                </button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-outline-primary w-100" onclick="loadPatternsFromAPI()">
                                    <i class="fas fa-sync-alt me-2"></i>–û–±–Ω–æ–≤–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
                    {% if difficulty_filter or yarn_weight_filter or search_query %}
                    <div class="active-filters mb-4" id="activeFilters">
                        {% if difficulty_filter %}
                        <span class="filter-tag">–°–ª–æ–∂–Ω–æ—Å—Ç—å: 
                            {% if difficulty_filter == 'beginner' %}–ù–∞—á–∏–Ω–∞—é—â–∏–π
                            {% elif difficulty_filter == 'easy' %}–õ–µ–≥–∫–∏–π
                            {% elif difficulty_filter == 'intermediate' %}–°—Ä–µ–¥–Ω–∏–π
                            {% elif difficulty_filter == 'experienced' %}–û–ø—ã—Ç–Ω—ã–π
                            {% else %}{{ difficulty_filter }}{% endif %}
                        </span>
                        {% endif %}
                        {% if yarn_weight_filter %}
                        <span class="filter-tag">–ü—Ä—è–∂–∞: {{ yarn_weight_filter }}</span>
                        {% endif %}
                        {% if search_query %}
                        <span class="filter-tag">–ü–æ–∏—Å–∫: "{{ search_query }}"</span>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ -->
                    <div class="page-info mb-3">
                        <p class="text-muted">
                            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}.
                            –ü–æ–∫–∞–∑–∞–Ω–æ {{ patterns|length }} –∏–∑ {{ page_obj.paginator.count }} —Å—Ö–µ–º.
                        </p>
                    </div>

                    <!-- –ù–æ–≤—ã–µ —Å—Ö–µ–º—ã (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ JS) -->
                    <div id="newPatternsContainer"></div>

                    <!-- –°–ø–∏—Å–æ–∫ —Å—Ö–µ–º -->
                    <div id="patternsContainer">
                        {% if patterns %}
                            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                                {% for pattern in patterns %}
                                <div class="col">
                                    <div class="card h-100 shadow-sm pattern-card" 
                                         style="animation-delay: {{ forloop.counter0|divisibleby:3|yesno:'0s,0.1s,0.2s' }};">
                                        
                                        <!-- –§–æ—Ç–æ -->
                                        {% if pattern.photo_url and pattern.photo_url != '#' %}
                                            <img src="{{ pattern.photo_url }}" class="card-img-top" 
                                                 alt="{{ pattern.name }}" style="height: 200px; object-fit: cover; cursor: pointer;"
                                                 onclick="openRavelryLink('{{ pattern.pattern_url|escapejs }}')">
                                        {% else %}
                                            <div class="card-img-top bg-light d-flex align-items-center justify-content-center" 
                                                 style="height: 200px; cursor: pointer;"
                                                 onclick="openRavelryLink('{{ pattern.pattern_url|escapejs }}')">
                                                <i class="fas fa-image fa-3x text-muted"></i>
                                            </div>
                                        {% endif %}
                                        
                                        <div class="card-body">
                                            <h5 class="card-title">{{ pattern.name|truncatechars:50 }}</h5>
                                            
                                            <!-- –ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                                            <div class="pattern-meta mb-3">
                                                {% if pattern.yarn_weight and pattern.yarn_weight != 'Not Specified' %}
                                                    <span class="badge bg-info me-1">
                                                        <i class="fas fa-yarn me-1"></i>{{ pattern.yarn_weight }}
                                                    </span>
                                                {% endif %}
                                                
                                                <span class="badge bg-secondary me-1">
                                                    {% if pattern.difficulty == 'beginner' %}üë∂ –ù–∞—á–∏–Ω–∞—é—â–∏–π
                                                    {% elif pattern.difficulty == 'easy' %}üòä –õ–µ–≥–∫–∏–π
                                                    {% elif pattern.difficulty == 'intermediate' %}üëç –°—Ä–µ–¥–Ω–∏–π
                                                    {% elif pattern.difficulty == 'experienced' %}üî• –û–ø—ã—Ç–Ω—ã–π
                                                    {% else %}{{ pattern.difficulty }}{% endif %}
                                                </span>
                                                
                                                {% if pattern.is_free %}
                                                    <span class="badge bg-success">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                                                {% endif %}
                                            </div>
                                            
                                            <!-- –†–µ–π—Ç–∏–Ω–≥ -->
                                            {% if pattern.rating and pattern.rating > 0 %}
                                                <div class="rating mb-2">
                                                    {% with full_stars=pattern.rating|floatformat:0 %}
                                                        {% for i in "12345"|make_list %}
                                                            {% if forloop.counter <= full_stars|add:0 %}
                                                                <i class="fas fa-star text-warning"></i>
                                                            {% else %}
                                                                <i class="far fa-star text-warning"></i>
                                                            {% endif %}
                                                        {% endfor %}
                                                    {% endwith %}
                                                    <small class="text-muted ms-2">{{ pattern.rating|floatformat:1 }}</small>
                                                </div>
                                            {% endif %}
                                            
                                            <!-- –ê–≤—Ç–æ—Ä -->
                                            {% if pattern.designer and pattern.designer != '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' %}
                                                <p class="card-text small text-muted">
                                                    <i class="fas fa-user me-1"></i> {{ pattern.designer|truncatechars:30 }}
                                                </p>
                                            {% endif %}
                                        </div>
                                        
                                        <div class="card-footer bg-white border-top-0">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <!-- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ -->
                                                <button class="btn btn-sm {% if pattern.id in favorite_pattern_ids %}btn-danger{% else %}btn-outline-danger{% endif %}"
                                                        onclick="toggleFavorite({{ pattern.id }}, this)">
                                                    <i class="{% if pattern.id in favorite_pattern_ids %}fas{% else %}far{% endif %} fa-heart"></i>
                                                    <span class="ms-1 d-none d-sm-inline">
                                                        {% if pattern.id in favorite_pattern_ids %}–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º{% else %}–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ{% endif %}
                                                    </span>
                                                </button>
                                                
                                                <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ Ravelry -->
                                                {% if pattern.pattern_url and pattern.pattern_url != '#' %}
                                                    <button onclick="openRavelryLink('{{ pattern.pattern_url|escapejs }}')" 
                                                            class="btn btn-sm ravelry-link">
                                                        <i class="fas fa-external-link-alt me-1"></i>–ù–∞ Ravelry
                                                    </button>
                                                {% else %}
                                                    <span class="text-muted small">
                                                        <i class="fas fa-lock me-1"></i>–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–∫—É–ø–∫–∞
                                                    </span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            
                            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                            {% if page_obj.paginator.num_pages > 1 %}
                            <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º" class="mt-5">
                                <ul class="pagination justify-content-center">
                                    {% if page_obj.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if difficulty_filter %}&difficulty={{ difficulty_filter }}{% endif %}{% if yarn_weight_filter %}&yarn_weight={{ yarn_weight_filter }}{% endif %}"
                                           aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∞—è">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                    {% else %}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% for num in page_obj.paginator.page_range %}
                                        {% if num == page_obj.number %}
                                            <li class="page-item active" aria-current="page">
                                                <span class="page-link">{{ num }}</span>
                                            </li>
                                        {% elif num > page_obj.number|add:-3 and num < page_obj.number|add:3 %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if difficulty_filter %}&difficulty={{ difficulty_filter }}{% endif %}{% if yarn_weight_filter %}&yarn_weight={{ yarn_weight_filter }}{% endif %}">
                                                    {{ num }}
                                                </a>
                                            </li>
                                        {% elif num == 1 or num == page_obj.paginator.num_pages %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if difficulty_filter %}&difficulty={{ difficulty_filter }}{% endif %}{% if yarn_weight_filter %}&yarn_weight={{ yarn_weight_filter }}{% endif %}">
                                                    {{ num }}
                                                </a>
                                            </li>
                                        {% elif num == page_obj.number|add:-3 or num == page_obj.number|add:3 %}
                                            <li class="page-item disabled">
                                                <span class="page-link">...</span>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                    
                                    {% if page_obj.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if difficulty_filter %}&difficulty={{ difficulty_filter }}{% endif %}{% if yarn_weight_filter %}&yarn_weight={{ yarn_weight_filter }}{% endif %}"
                                           aria-label="–°–ª–µ–¥—É—é—â–∞—è">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                    {% else %}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </nav>
                            {% endif %}
                            
                        {% else %}
                            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç —Å—Ö–µ–º -->
                            <div class="empty-state text-center py-5">
                                <div class="empty-icon mb-4">
                                    <i class="fas fa-search fa-3x text-muted"></i>
                                </div>
                                <h3 class="mb-3">–°—Ö–µ–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                                <p class="text-muted mb-4">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ —Å—Ö–µ–º—ã</p>
                                <button class="btn btn-primary" onclick="loadPatternsFromAPI()">
                                    <i class="fas fa-sync-alt me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ —Å—Ö–µ–º—ã
                                </button>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="footer">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="footer-title d-flex align-items-center">
                        <img src="{% static 'images/logo.jpg' %}" alt="KnitMatch" height="40" class="rounded-circle me-2">
                        <div>
                            <span style="color: #8a4fff; font-weight: 600;">Knit</span>
                            <span style="color: #00d4aa; font-weight: 600;">Match</span>
                        </div>
                    </div>
                    <p class="footer-text mt-2">
                        –°–æ–æ–±—â–µ—Å—Ç–≤–æ –≤—è–∑–∞–ª—å—â–∏—Ü, —Å–æ–∑–¥–∞–Ω–Ω–æ–µ —Å <i class="fas fa-heart" style="color: #ff6b8b;"></i> –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="text-muted mb-0">¬© 2026 KnitMatch. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div id="notification" class="notification alert alert-success d-none" role="alert"></div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/projects.js' %}"></script>
    
    <!-- CSRF —Ç–æ–∫–µ–Ω –¥–ª—è AJAX –∑–∞–ø—Ä–æ—Å–æ–≤ -->
    <script>
        // CSRF —Ç–æ–∫–µ–Ω –¥–ª—è AJAX
        const csrfToken = "{{ csrf_token }}";
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ Ravelry
        function openRavelryLink(url) {
            if (url && url !== '#') {
                window.open(url, '_blank');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function applyFilters() {
            const difficulty = document.getElementById('difficultyFilter').value;
            const yarnWeight = document.getElementById('yarnWeightFilter').value;
            const searchQuery = document.getElementById('searchInput').value;
            const freeOnly = document.getElementById('freeOnly').checked ? 'true' : '';
            
            let url = '?';
            
            if (difficulty) url += `difficulty=${difficulty}&`;
            if (yarnWeight) url += `yarn_weight=${yarnWeight}&`;
            if (searchQuery) url += `search=${encodeURIComponent(searchQuery)}&`;
            if (freeOnly) url += `free=${freeOnly}&`;
            
            // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π & –∏–ª–∏ ?
            url = url.replace(/[&?]$/, '');
            
            window.location.href = url || '?';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function resetFilters() {
            window.location.href = '{% url "projects" %}';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º —á–µ—Ä–µ–∑ API
        function loadPatternsFromAPI() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>–ó–∞–≥—Ä—É–∑–∫–∞...';
            button.disabled = true;
            
            fetch('{% url "refresh_patterns" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': csrfToken,
                },
                body: 'count=6'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(data.message, 'success');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    showNotification(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', 'danger');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ö–µ–º', 'danger');
            })
            .finally(() => {
                button.innerHTML = originalText;
                button.disabled = false;
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification alert alert-${type} fade show`;
            notification.classList.remove('d-none');
            
            setTimeout(() => {
                notification.classList.add('fade');
                setTimeout(() => {
                    notification.classList.add('d-none');
                    notification.classList.remove('fade');
                }, 500);
            }, 3000);
        }
    </script>
</body>
</html>